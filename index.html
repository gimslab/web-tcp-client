<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>tcp client</title>
    <script src="./js/jquery-1.7.2.min.js"></script>
    <script src="./js/jquery.mousewheel-min.js"></script>
    <script src="./js/jquery.terminal-0.9.3.min.js"></script>
    <link href="./css/jquery.terminal.css" rel="stylesheet"/>
  </head>
<script>

const net = require('net');

// const client = net.connect({host: 'localhost', port:9999}, () => {
const client = net.connect({host: '10.10.168.16', port:9999}, () => {
	$('#term').terminal().echo('connected to server!');
});

const fstream = require('fs').createWriteStream('web-tcp-client.log', {flags:'w+'});

jQuery(document).ready(function($) {

	$('#term').terminal(function(command, term) {
		fstream.write(command+'\n');
		if (command.length>0)
			client.write(command+'\n');
	}, {prompt: '> ', height: 500
		, completion: ['checkSale', 'checkSaleDiff', 'getKan']
	});

	client.on('data', (data) => {
		$('#term').terminal().echo(data);
		fstream.write(data);
		require('fs').writeFile('last-resp.csv', data, function(err){
			if(err)
				return $('#term').terminal().echo(err);
		});
	});

	client.on('end', () => {
		$('#term').terminal().echo('disconnected from server');
	});

});
</script>

<body>
<div><a href='last-resp.csv'>last-resp.csv</a></div>
<div id='term'></div>
</body>
</html>
